<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ADMIN KEY PANEL</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#000;color:#00ff66;font-family:monospace}
.box{max-width:420px;margin:auto;border:2px solid #00ff66;padding:14px}
input,select,button{width:100%;padding:10px;margin:6px 0;background:#000;color:#00ff66;border:1px solid #00ff66}
button{cursor:pointer}
button.danger{border-color:#ff4444;color:#ff4444}
.list{border:1px dashed #00ff66;padding:8px;margin-top:10px;font-size:13px}
.key{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
.popup{
 position:fixed;inset:0;background:rgba(0,0,0,.8);
 display:none;align-items:center;justify-content:center
}
.popupBox{border:2px solid #00ff66;padding:15px;width:280px;text-align:center}
</style>
</head>
<body>

<div class="box">
<h3>üîë ADMIN KEY</h3>

<input id="key" placeholder="Key (VD: VIP-ABC123)">
<select id="type">
<option value="FREE">FREE</option>
<option value="VIP">VIP</option>
</select>

<input id="device" placeholder="ID thi·∫øt b·ªã (DEV-xxxx)">
<label>‚è≥ H·∫øt h·∫°n:</label>
<input id="expire" type="datetime-local">

<button onclick="createKey()">‚ûï T·∫†O KEY</button>

<div class="list" id="list">Loading...</div>
</div>

<!-- POPUP -->
<div class="popup" id="popup">
 <div class="popupBox">
  <p id="popupText"></p>
  <button onclick="closePopup()">OK</button>
 </div>
</div>

<script>
const SERVER="https://admin-key-server.onrender.com";

function showPopup(text){
 popupText.innerText=text;
 popup.style.display="flex";
}
function closePopup(){ popup.style.display="none"; }

async function loadKeys(){
 const res = await fetch(SERVER+"/admin/keys");
 const data = await res.json();
 let html="";
 Object.keys(data).forEach(k=>{
  const v=data[k];
  html+=`
   <div class="key">
    <span>
     ${k}<br>
     ${v.type} | ${new Date(v.expire).toLocaleString()}<br>
     üÜî ${v.device || "Ch∆∞a g·∫Øn"}
    </span>
    <button class="danger" onclick="delKey('${k}')">‚ùå</button>
   </div>`;
 });
 list.innerHTML = html || "Ch∆∞a c√≥ key";
}

async function createKey(){
 if(!key.value || !expire.value)
  return showPopup("Nh·∫≠p ƒë·ªß key & h·∫°n d√πng");

 const res = await fetch(SERVER+"/admin/create",{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  body:JSON.stringify({
   key:key.value,
   type:type.value,
   device:device.value,
   expire:new Date(expire.value).getTime()
  })
 });

 const d = await res.json();
 if(!d.ok) return showPopup(d.msg);

 showPopup("‚úÖ T·∫°o key th√†nh c√¥ng");
 key.value=""; device.value="";
 loadKeys();
}

async function delKey(k){
 if(!confirm("X√≥a key "+k+"?")) return;
 await fetch(SERVER+"/admin/delete",{
  method:"POST",
  headers:{ "Content-Type":"application/json" },
  body:JSON.stringify({ key:k })
 });
 loadKeys();
}

loadKeys();
</script>
</body>
</html>